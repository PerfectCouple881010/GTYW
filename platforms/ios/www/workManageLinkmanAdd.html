<!doctype html>
<html>
<head>
<meta charset="utf-8">
<meta http-equiv = "X-UA-Compatible" content = "IE=edge,chrome=1" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=yes" /> 
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black">

<title>贯通综合管理系统-机会管理—机会新增</title>
<link href="css/mui.min.css" rel="stylesheet" />
<link href="css/mui.indexedlist.css" rel="stylesheet" />
<link rel="stylesheet" type="text/css" href="css/app.css" />
<link rel="stylesheet" type="text/css" href="css/base.css">
<link rel="stylesheet" type="text/css" href="css/main.css">
<link href="css/mobiscroll.min.css" rel="stylesheet" type="text/css" />
<script type="text/javascript" src="js/jquery-1.7.1.js"></script>
<link rel="stylesheet" type="text/css" href="sweetalert-master/css/sweetalert.css">
<script type="text/javascript" src="sweetalert-master/js/sweetalert.min.js"></script>
<style>
.mui-bar {
	-webkit-box-shadow: none;
	box-shadow: none;
}

#done.mui-disabled {
	color: gray;
}

.mui-table-view-cell.mui-checkbox input[type=checkbox],.mui-table-view-cell.mui-radio input[type=radio] {
	top: 16px;
}
</style>
</head>
<body>
<div id="offCanvasWrapper" class="mui-off-canvas-wrap mui-draggable">
	<!--侧滑菜单部分-->
	<aside id="offCanvasSide" class="  mui-off-canvas-right" style="background: none">
			<header class="mui-bar mui-bar-nav">
				<a class=" mui-icon mui-icon-left-nav mui-pull-left" id="offCanvasHide"></a>
				<span id="zhHead"></span>
			</header>	
			<div id="offCanvasSideScroll" class="mui-scroll-wrapper">
				<div class="mui-scroll">				
					<div class="mui-content">
						<div id='list' class="mui-indexed-list">
							<div class="mui-indexed-list-search mui-input-row mui-search">
								<input type="search" class="mui-input-clear mui-indexed-list-search-input" placeholder="请输入搜索内容">
							</div>
							<div class="mui-indexed-list-alert"></div>
							<div class="mui-indexed-list-inner">
								<div class="mui-indexed-list-empty-alert">没有数据</div>
								<ul class="mui-table-view" id ="ryList">
									<li class="mui-table-view-cell mui-indexed-list-item mui-checkbox mui-media mui-left">
									</li>
								</ul>
							</div>
						</div>
					</div>
				</div>
			</div>
		</aside>
		<div class="mui-inner-wrap">
<header class="mui-bar mui-bar-nav">
    <!-- <a class="headerL" href="javascript:history.go(-1);"><img src="images/return.png"></a>
    联系人新增 -->
    <a class="mui-action-back mui-icon mui-icon-left-nav mui-pull-left"></a>
    <h1 class="mui-title">联系人新增</h1>
</header>
<div id="offCanvasContentScroll" class="mui-content mui-scroll-wrapper">
				<div class="mui-scroll">
					<div class="mui-content-padded">
		<form class="mui-input-group" id="addJhForm">
            <div class="mui-input-row">
               <label><span style="color:red">*</span> <span><span style="letter-spacing:2rem;">姓</span>名</span></label>
                <input type="text" maxlength="10" style="width:60%;" placeholder="请输入名称" id="name" validate="*" errorMsg="姓名必填">
            </div>
            <div class="mui-input-row">
                <label><span style="color:red">*</span> <span><span style="letter-spacing:2rem;">性</span>别</span></label>
				<select value="" name="sex" id="sex" validate="*" errorMsg="性别必填" >
                </select>
            </div>
            <div class="mui-input-row">
               <label><span style="color:red"></span> <span><span style="letter-spacing:2rem;">职</span>位</span></label>
                <input type="text" maxlength="10" style="width:60%;" placeholder="请输入职位" placeholder="" value="" name="position" id="position" >
            </div>
            <div class="mui-input-row">
                 <label><span>&nbsp;&nbsp;</span><span style="letter-spacing:0.5px;">办公电话</span></label>
                <input type="text" maxlength="13"  style="width:60%;" placeholder="请输办公入电话" placeholder="" value="" name="phoneOffice" id="phoneOffice" validate="" errorMsg="办公电话格式有误或为空，请重新填写">
            </div>
            <div class="mui-input-row">
                <label><span style="color:red"></span> <span style="letter-spacing:0.5px;">移动电话</span></label>
                <input type="text" maxlength="11" style="width:60%;" placeholder="请输入移动电话" placeholder="" value="" name="phoneMobile" id="phoneMobile" validate="mpn" errorMsg="移动电话格式有误或为空，请重新填写">
            </div>
            <div class="mui-input-row">
              <label><span style="color:red"></span> <span style="letter-spacing:0.5px;"> 电子邮箱</span></label>
                <input type="text"  style="width:60%;" placeholder="请输入邮箱" placeholder="" value="" name="eMail" id="eMail" validate="en" errorMsg="电子邮箱填写有误或为空，请重新填写">
            </div>
             <div class="mui-input-row">
               <label><span style="color:red">&nbsp</span> <span><span style="letter-spacing:2rem;">传</span>真</span></label>
                <input type="text" maxlength="13" style="width:60%;" placeholder="请输入传真" placeholder="" value="" name="phoneFax" id="phoneFax"  validate="" errorMsg="传真格式有误或为空，请重新填写">
            </div>
            <div class="mui-input-row">
               <label><span style="color:red"></span> <span style="letter-spacing:0.5px;">联系地址</span></label>
                <input type="text" maxlength="20" style="width:60%;" placeholder="请输入联系地址" placeholder="" value="" name="address" id="address" validate="" errorMsg="联系地址必填">
            </div>
            <div class="mui-input-row" id="offCanvasShow">
               <label><span style="color:red">&nbsp;</span> <span style="letter-spacing:0.5px;">关联客户</span></label>
				<input type="text" class="mui-input  " id="customerName" value="" readonly="readonly" placeholder="请选择客户" validate="" errorMsg="客户必填">
	            <input id="customerId" type="hidden"  name="customerId"  value="" />
	            <!-- <a class="mui-navigate-right" id="offCanvasShow"  /></a> -->
            </div>
            
        <div class="mui-input-row">
            <label><span style="color:red">&nbsp;</span>备注</label>
        </div>
        <textarea placeholder="请输入备注" id="note"></textarea>
    <!-- <div class="DetailBotBtn1 DetailBotBtn2">
        <a href="workManageLinkman.html">取消新增</a>
        <a href="javascript:void(0);" id="wancheng">确认新增</a>
    </div> -->
    <div class="mui-button-row" style="height:57px">
		<div class="DetailBotBtn1 DetailBotBtn2">       
			<a  class="back header_button  mui-action-back">取消新增</a>
			<a href="javascript:void(0);" class="newproject header_button" id="tijiao">确认新增</a>
		</div>
	</div>
</form>
</div></div></div></div></div>
<script src="lib/jquery-2.1.4.min.js"></script>
<script src="js/mui.min.js"></script>
<script src="js/mui.indexedlist.js"></script>
<script src="js/app.js"></script>
<script type="text/javascript" src="js/index.js"></script>
<script type="text/javascript" src="js/initInfo.js"></script>
<script type="text/javascript" src="js/iscroll.js" ></script>
<script src="js/mobiscroll.min.js"></script>
<script type="text/javascript">
mui.init();
//$(function () {});
mui.ready(function() {
intiBaseByType(serverIp,"sid","currentIntent","/dataDir/listName.do","yxz");
var userId =localStorage.getItem("id");
$('#chargerNameId').val(userId);
//getxmList();
//侧滑容器父节点
var offCanvasWrapper = mui('#offCanvasWrapper');
 //主界面容器
var offCanvasInner = offCanvasWrapper[0].querySelector('.mui-inner-wrap');
 //菜单容器
var offCanvasSide = document.getElementById("offCanvasSide");
if (!mui.os.android) {
	var spans = document.querySelectorAll('.android-only');
	for (var i = 0, len = spans.length; i < len; i++) {
		spans[i].style.display = "none";
	}
}
//主界面‘显示侧滑菜单’按钮的点击事件--关联客户 
document.getElementById('offCanvasShow').addEventListener('tap', function() {
	var title='<h1 class="mui-title">选择人员</h1>'+
	'<a id="done" class="mui-btn mui-btn-link mui-pull-right mui-btn-blue mui-disabled">完成</a>';
	document.querySelector('#zhHead').innerHTML = title;
	getCustomerList();
	offCanvasWrapper.offCanvas('show');
	var header = document.querySelector('header.mui-bar');
	var list = document.getElementById('list');
	var done = document.getElementById('done');
	//calc hieght
	//list.style.height =(document.body.offsetHeight - header.offsetHeight) + 'px';
	list.style.height = '100%';
	//create
	window.indexedList = new mui.IndexedList(list);
	//done event
	done.addEventListener('tap', function() {
		var checkboxArray = [].slice.call(list.querySelectorAll('input[type="checkbox"]'));
		var checkedValues = [],ryids=[];
		checkboxArray.forEach(function(box) {
			if (box.checked) {
			   //checkedValues.push(box.parentNode.innerText);
			   checkedValues.push(box.getAttribute("ryname"));
				ryids.push(box.value);
			}
		});
		if (checkedValues.length > 0) {
		//mui.alert('你选择了: ' + ryids );
		document.getElementById('customerName').value=checkedValues;
		document.getElementById('customerId').value=ryids;
		offCanvasWrapper.offCanvas('close');
		 } else {
			mui.swal('你没选择任何人员');
		}
	}, false);
	mui('.mui-indexed-list-inner').on('change', 'input', function() {
		var count = list.querySelectorAll('input[type="checkbox"]:checked').length;
		var value = count ? "完成(" + count + ")" : "完成";
		done.innerHTML = value;
		if (count) {
			if (done.classList.contains("mui-disabled")) {
				done.classList.remove("mui-disabled");
			}
		} else {
			if (!done.classList.contains("mui-disabled")) {
				done.classList.add("mui-disabled");
			}
		}
	});
});

//菜单界面，‘关闭侧滑菜单’按钮的点击事件//
document.getElementById('offCanvasHide').addEventListener('tap', function() {
	offCanvasWrapper.offCanvas('close');
});

var tjButton = document.getElementById('tijiao');
var userId =localStorage.getItem("id");
	$(document).ready(function(){
		intiBaseDic(serverIp,"pid","customerId","/customer/listName.do?id="+userId);
		intiBaseByType(serverIp,"pid","sex","/dataDir/listName.do","xb");//性别的列表
		tjButton.addEventListener('tap', function(event) {
			var tjInfo = $("#addJhForm").serializeJson();
			console.log(tjInfo)
			//validateForm验证
				var result = true;
				$("form input[type='text']").each(function(){
					if($(this).attr("validate")!=null&&!validateForm($(this))){
						result = false;
						return result;
					}
					
				});
				if(result != false){
				$("select").each(function(){
					if($(this).attr("validate")!=null&&!validateForm($(this))){
						result = false;
						return result;
					}
				});}
			if(result){
			$.ajax({
			type:'post',
			url: 'http://'+serverIp+'/gtims/linkman/insertForPhone.do',
			data: {'createrId':userId,'modifyPersonId':userId,'name':$('#name').val(),'sex':$('#sex').val(),'position':$('#position').val(),'phoneOffice':$('#phoneOffice').val(),'phoneMobile':$('#phoneMobile').val(),'eMail':$('#eMail').val(),'phoneFax':$('#phoneFax').val(),'address':$('#address').val(),'customerId':$('#customerId').val(),'note':$('#note').val()},
			dataType: 'json',
			crossDomain: true,	
			success: function(data) {
				location.href='workManageLinkman.html';
			},
			error:function(msg){
				swal("访问出错！");
			}
		});
			}
			});
	});
		//participants.value = userName ;
		 //主界面和侧滑菜单界面均支持区域滚动；
				mui('#offCanvasSideScroll').scroll();
				mui('#offCanvasContentScroll').scroll();
				 //实现ios平台原生侧滑关闭页面；
				if (mui.os.plus && mui.os.ios) {
					mui.plusReady(function() { //5+ iOS暂时无法屏蔽popGesture时传递touch事件,直接屏蔽popGesture功能
						plus.webview.currentWebview().setStyle({
							'popGesture': 'none'
						});
					});
				}
				
				});
		
	//查询客户 
		function getCustomerList(){
				$.ajax({
					url: 'http://'+serverIp+'/gtims/customer/list.do?userId='+localStorage.getItem("id"),
					async: false,
					data:{'start':'0','end':'10000'},
					dataType: 'json',
					crossDomain: true,
					success: function(data) {
					 var html = "",obj=data.data;
						for (var i = 0; i < obj.length; i++) {
						    html+='<li class="mui-table-view-cell mui-indexed-list-item mui-checkbox mui-media mui-left">'+
							'<input type="checkbox" value="'+obj[i].id+'" ryname="'+obj[i].name+'" /> '+
										'<img class="mui-media-object mui-pull-left" src="images/linkman.png">'+
											'<div class="mui-media-body mui-ellipsis">'+obj[i].name+'('+obj[i].customerTypeShow+')'+
												'<p class="mui-ellipsis">'+obj[i].phoneOffice+'</p>'+
											'</div></li>';
						}
					document.querySelector('#ryList').innerHTML = html;
				}
				})
					}
</script>
</body>
</html>