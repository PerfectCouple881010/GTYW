<!doctype html>
<html>
<head>
<meta charset="utf-8">
<meta http-equiv = "X-UA-Compatible" content = "IE=edge,chrome=1" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=yes" /> 
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black">

<title>贯通综合管理系统-客户管理—客户修改</title>
<link href="css/mui.min.css" rel="stylesheet" />
<link href="css/mui.indexedlist.css" rel="stylesheet" />
<link rel="stylesheet" type="text/css" href="css/app.css" />
<link rel="stylesheet" type="text/css" href="css/base.css">
<link rel="stylesheet" type="text/css" href="css/main.css">
<link href="css/mobiscroll.min.css" rel="stylesheet" type="text/css" />
<link rel="stylesheet" type="text/css" href="sweetalert-master/css/sweetalert.css">
<script type="text/javascript" src="sweetalert-master/js/sweetalert.min.js"></script>
<style>
.mui-bar {
	-webkit-box-shadow: none;
	box-shadow: none;
}

#done.mui-disabled {
	color: gray;
}

.mui-table-view-cell.mui-checkbox input[type=checkbox],.mui-table-view-cell.mui-radio input[type=radio] {
	top: 16px;
}
</style>
</head>
<body>
<div id="offCanvasWrapper" class="mui-off-canvas-wrap mui-draggable">
	<!--侧滑菜单部分-->
	<aside id="offCanvasSide" class="  mui-off-canvas-right" style="background: none">
			<header class="mui-bar mui-bar-nav">
				<a class=" mui-icon mui-icon-left-nav mui-pull-left" id="offCanvasHide"></a>
				<span id="zhHead"></span>
			</header>	
			<div id="offCanvasSideScroll" class="mui-scroll-wrapper">
				<div class="mui-scroll">				
					<div class="mui-content">
						<div id='list' class="mui-indexed-list">
							<div class="mui-indexed-list-search mui-input-row mui-search">
								<input type="search" class="mui-input-clear mui-indexed-list-search-input" placeholder="请输入搜索内容">
							</div>
							<div class="mui-indexed-list-alert"></div>
							<div class="mui-indexed-list-inner">
								<div class="mui-indexed-list-empty-alert">没有数据</div>
								<ul class="mui-table-view" id ="ryList">
									<li class="mui-table-view-cell mui-indexed-list-item mui-checkbox mui-media mui-left">
									</li>
								</ul>
							</div>
						</div>
					</div>
				</div>
			</div>
		</aside>
		<div class="mui-inner-wrap">
<header class="mui-bar mui-bar-nav">
   <!--  <a class="headerL" href="javascript:history.go(-1);"><img src="images/return.png"></a> -->
    <a class="mui-action-back mui-icon mui-icon-left-nav mui-pull-left"></a>
    <h1 class="mui-title"> 客户修改</h1>
    <!-- <a class="headerL" href="javascript:history.go(-1);"><img src="images/return.png"></a>
    客户修改 -->
</header>
<div id="offCanvasContentScroll" class="mui-content mui-scroll-wrapper">
				<div class="mui-scroll">
					<div class="mui-content-padded">
		<form class="mui-input-group" id="addJhForm">
            <div class="mui-input-row">
                <label><span style="color:red">*</span><span> 客户名称</span></label>
                <input type="text" placeholder="请输入客户名称" id="name" name="name" validate="*" errorMsg="客户名称必填">
            </div>
            <div class="mui-input-row">
                <label><span style="color:red">*</span><span> 类&nbsp;&nbsp;&nbsp;&nbsp;型</span></label>
                 <select name="customerType" class="select" id="customerType" validate="*" errorMsg="客户类型必填">
				</select>
				 <input type="hidden" type="text" placeholder="" name="ctid" id="ctid"/>
            </div>
            <div class="mui-input-row">
                <label><span style="color:red">*</span><span> 行&nbsp;&nbsp;&nbsp;&nbsp;业</span></label>
                 <input type="text" placeholder="请输入行业" id="industry" name="industry" validate="*" errorMsg="行业必填"/>
            </div>
            <div class="mui-input-row">
                <label><span style="color:red">&nbsp;&nbsp;</span><span> 传&nbsp;&nbsp;&nbsp;&nbsp;真</span></label>
                 <input type="text" placeholder="请输入传真" id="phoneFax"  validate="" errorMsg="请输入正确的传真格式"/>  
            </div>
            <div class="mui-input-row">
                <label><span style="color:red">*</span><span> 所属省份</span></label>
             <select value="" name="addressProvince" id="addressProvince" validate="*" errorMsg="省份必填" >
			</select>
			<input type="hidden" type="text" placeholder="" name="sheng" id="sheng"/>
            </div>
            <div class="mui-input-row">
                <label><span style="color:red">*</span><span> 所属城市</span></label>
             	<select name="" id="addressCity" validate="*" errorMsg="城市必填">
                    <option value="0">请选择市</option>
                </select>
                <input type="hidden" type="text" placeholder="" name="shi" id="shi"/>
            </div>
            <div class="mui-input-row">
                <label><span style="color:red">*</span><span> 所属区县</span></label>
             	<select name="" id="addressState" validate="*" errorMsg="区县必填">
                    <option value="0">请选择区县</option>
                </select>
                <input type="hidden" type="text" placeholder="" name="qu" id="qu"/>
            </div>
            <div class="mui-input-row">
                <label><span style="color:red">*</span><span> 所属街道</span></label>
             	 <select name="" id="addressStreet" validate="*" errorMsg="街道必填">
                    <option value="0">请选择街道</option>
                </select>
                <input type="hidden" type="text" placeholder="" name="jie" id="jie"/>	
            </div>
            <div class="mui-input-row">
                <label><span>&nbsp;&nbsp;</span><span>详细地址</span></label>
				<input type="text" placeholder="请输入详细地址" id="addressDetailed" /> 
            </div>
            <div class="mui-input-row">
                <label><span style="color:red">*</span><span> 邮&nbsp;&nbsp;&nbsp;&nbsp;编</span></label>
                 <input type="text" placeholder="" id="addressPostalcode" />    
            </div>
            <div class="mui-input-row">
                <label><span>&nbsp;&nbsp;</span><span>网&nbsp;&nbsp;&nbsp;&nbsp;址</span></label>
                 <input type="text" placeholder="" id="website" />    
            </div>
            <div class="mui-input-row">
                <label><span style="color:red">*</span><span> 办公电话</span></label>
				<input type="text" placeholder="请输入办公电话" id="phoneOffice" validate="p" errorMsg="办公电话格式有误，请填写正确的电话格式"/>
            </div>
            <div class="mui-input-row">
                <label><span style="color:red">*</span><span>手&nbsp;&nbsp;机</span></label>
				<input type="text" placeholder="请输入其他电话" id="phoneAlternate" validate="mp" errorMsg="请填写正确的手机号码格式"/>
            </div>
            <div class="mui-input-row" id="offCanvasShowFZR">
                <label><span style="color:red">*</span><span> 负责人</span></label>
				<input type="text" class="mui-input  " id="chargePersonName" value="" readonly="readonly" placeholder="请选择客户负责人" validate="*" errorMsg="客户负责人必填">
               <input id="chargePerson" type="hidden"  name="chargePerson"  value="" />
               <!-- <a class="mui-navigate-right" id="offCanvasShowFZR"  /></a> -->
				<!-- <input type="text" placeholder="请输入客户负责人" id="chargePerson" validate="*" errorMsg="客户负责人必填"/> -->
            </div>
            <div class="mui-input-row">
                <label><span>&nbsp;&nbsp;</span><span>备&nbsp;&nbsp;&nbsp;&nbsp;注</span></label>
                 <input type="text" placeholder="请输入备注" id="note" />    
            </div>
    <!-- <div class="DetailBotBtn1 DetailBotBtn2">
        <a href="javascript:history.go(-1);" >取消修改</a>
        <a href="#2" id="wancheng">确认修改</a>
    </div> -->
    <div class="mui-button-row" style="height:57px">
		<div class="DetailBotBtn1 DetailBotBtn2">       
			<a  class="back header_button  mui-action-back">取消修改</a>
			<a href="javascript:void(0);" class="newproject header_button" id="tijiao">确认修改</a>
		</div>
	</div>
</form>
</div></div></div></div></div>
<script type="text/javascript" src="js/jquery-1.9.1.js" ></script>
<script src="lib/jquery-2.1.4.min.js"></script>
<script src="js/mui.min.js"></script>
<script src="js/mui.indexedlist.js"></script>
<script src="js/app.js"></script>
<script type="text/javascript" src="js/jquery.js"></script>
<script type="text/javascript" src="js/index.js"></script>
<script type="text/javascript" src="js/initInfo.js"></script>
<script type="text/javascript" src="js/iscroll.js" ></script>
<script src="js/mobiscroll.min.js"></script>
<script type="text/javascript">
mui.init();
//$(function () {});
		mui.ready(function() {
var userId =localStorage.getItem("id");
		//getxmList();
	  //侧滑容器父节点
		var offCanvasWrapper = mui('#offCanvasWrapper');
		 //主界面容器
		var offCanvasInner = offCanvasWrapper[0].querySelector('.mui-inner-wrap');
		 //菜单容器
		var offCanvasSide = document.getElementById("offCanvasSide");
		if (!mui.os.android) {
			var spans = document.querySelectorAll('.android-only');
			for (var i = 0, len = spans.length; i < len; i++) {
				spans[i].style.display = "none";
			}
		}
		
		//主界面‘显示侧滑菜单’按钮的点击事件 ---负责人
		document.getElementById('offCanvasShowFZR').addEventListener('tap', function() {
			var title='<h1 class="mui-title">选择负责人</h1>'+
			'<a id="done" class="mui-btn mui-btn-link mui-pull-right mui-btn-blue mui-disabled">完成</a>';
			document.querySelector('#zhHead').innerHTML = title;
			gethtList();
			offCanvasWrapper.offCanvas('show');
			var header = document.querySelector('header.mui-bar');
			var list = document.getElementById('list');
			var done = document.getElementById('done');
			//calc hieght
			//list.style.height =(document.body.offsetHeight - header.offsetHeight) + 'px';
			list.style.height = '100%';
			//create
			window.indexedList = new mui.IndexedList(list);
			//done event
			done.addEventListener('tap', function() {
				var chargePerson = $("input[name='radio']:checked").val();
				var chargePersonName = $("input[name='radio']:checked").attr("ryname");
				if (chargePerson > 0) {
				document.getElementById('chargePersonName').value=chargePersonName;
				document.getElementById('chargePerson').value=chargePerson;
				offCanvasWrapper.offCanvas('close');
				 } else {
					mui.swal('你没选择任何负责人');
				}
				
			}, false);
			mui('.mui-indexed-list-inner').on('change', 'input', function() {
				var count = list.querySelectorAll('input[type="radio"]:checked').length;
				var value = count ? "完成(" + count + ")" : "完成";
				done.innerHTML = value;
				//mui.alert('你选择了: ' + radiovalue );
				if (count) {
					if (done.classList.contains("mui-disabled")) {
						done.classList.remove("mui-disabled");
					}
				} else {
					if (!done.classList.contains("mui-disabled")) {
						done.classList.add("mui-disabled");
					}
				}
			});
		});
		
		 //菜单界面，‘关闭侧滑菜单’按钮的点击事件//
		document.getElementById('offCanvasHide').addEventListener('tap', function() {
			offCanvasWrapper.offCanvas('close');
		});



intiBaseByType(serverIp,"ctid","customerType","/dataDir/listName.do","khlx");
		var id = location.href.split('?')[1].split('=')[1];
		//alert(id);
		$.ajax({
			type:'post',
			url: 'http://'+serverIp+'/gtims/customer/editForPhone.do',
			data: {'id':id},
			dataType: 'json',
			crossDomain: true,	
			success: function(data) {
				$('#name').val(data.name);
				$('#customerType').val(data.customerType);
				$('#industry').val(data.industry);
				$('#phoneFax').val(data.phoneFax);
				$('#addressProvince').val(data.addressProvince);
				$('#addressCity').val(data.addressCity);
				$('#addressState').val(data.addressState);
				$('#addressStreet').val(data.addressStreet);
				$('#sheng').val(data.addressProvince);
				$('#shi').val(data.addressCity);
				$('#qu').val(data.addressState);
				$('#jie').val(data.addressStreet);
				$('#addressDetailed').val(data.addressDetailed);
				$('#addressPostalcode').val(data.addressPostalcode);
				$('#website').val(data.website);
				$('#phoneOffice').val(data.phoneOffice);
				$('#phoneAlternate').val(data.phoneAlternate);
				$('#chargePerson').val(data.chargePerson);
				$('#chargePersonName').val(data.chargePersonShow);
				$('#note').val(data.note);
				//初始化 省份下拉列表里面列出所有可选省份，地区下拉列表清空，市县下拉列表清空
				$("#addressProvince").empty();
					intiBaseDic(serverIp,"sheng","addressProvince","/region/findProvince.do");//addressProvince
				//清空地区下拉列表
				$("#addressCity").empty();
				intiRegionByregionCode(serverIp,"shi","addressCity","/region/findCityOrState.do",data.addressProvince);
				//清空市县下拉列表
				$("#addressState").empty();
				intiRegionByregionCode(serverIp,"qu","addressState","/region/findCityOrState.do",data.addressCity);

				//清空街道下拉列表
				$("#addressStreet").empty();
				intiRegionByregionCode(serverIp,"jie","addressStreet","/region/findCityOrState.do",data.addressState);
			},
			error:function(msg){
				swal("访问出错！");
			}
		});

		var tjButton = document.getElementById('tijiao');
        tjButton.addEventListener('tap', function(event) {
			var userId =localStorage.getItem("id");
				//validateForm验证
				var result = true;
				$("form input[type='text']").each(function(){
					if($(this).attr("validate")!=null&&!validateForm($(this))){
						result = false;
						return result;
					}
					
				});
				if(result != false){
				$("select").each(function(){
					if($(this).attr("validate")!=null&&!validateForm($(this))){
						result = false;
						return result;
					}
				});}
			if(result){
			$.ajax({
				type:'post',
				url: 'http://'+serverIp+'/gtims/customer/updateForPhone.do',
				data: {'modifyPersonId':userId,'name':$('#name').val(),
					'customerType':$('#customerType').val(),
					'industry':$('#industry').val(),
					'rating':$('#rating').val(),
					'phoneFax':$('#phoneFax').val(),
					'addressProvince':$('#addressProvince').val(),
					'addressCity':$('#addressCity').val(),
					'addressState':$('#addressState').val(),
					'addressStreet':$('#addressStreet').val(),
					'addressDetailed':$('#addressDetailed').val(),
					'addressPostalcode':$('#addressPostalcode').val(),
					'website':$('#website').val(),
					'phoneOffice':$('#phoneOffice').val(),
					'phoneAlternate':$('#phoneAlternate').val(),
					'chargePerson':$('#chargePerson').val(),
					'note':$('#note').val(),'id':id},
				dataType: 'json',
				crossDomain: true,	
				success: function(data) {
					location.href='workManageCustomer.html';
				},
				error:function(msg){
					swal("访问出错！");
				}
			});
			}
			})
		/* 省、地区、县市、街道四级联动下拉列表
		*/
		//省、地区、市县、街道四级联动下拉列表，初始只有前3个，只有当前3个都选中，并且存在街道列表的时候才显示第4级下拉列表
		$(document).ready(function(){init();sel();});
		
		function init(){
			
		}
		function sel(){
			//省份下拉列表改变的时候调用的方法，此时联动把地区内容显示到地区下拉列表中
			$("#addressProvince").change(
				function(){
					//把数组中的地区数据显示到地区列表中
					$("#addressCity").empty();
					intiRegionByregionCode(serverIp,"acid","addressCity","/region/findCityOrState.do",$("#addressProvince option:selected").val());

					//清空县市下拉列表
					$("#addressState").empty();
					$("<option value=\"0\">请选择</option>").appendTo($("#addressState"));

					//清空街道下拉列表
					$("#addressStreet").empty();
					$("<option value=\"0\">请选择</option>").appendTo($("#addressStreet"));
				}
			);

			//地区下拉列表改变的时候调用的方法，此时联动把县市内容显示到下拉列表中
			$("#addressCity").change(
				function(){
					//把数组中的县市数据追加到列表中
					$("#addressState").empty();
					intiRegionByregionCode(serverIp,"acid","addressState","/region/findCityOrState.do",$("#addressCity option:selected").val());
					
					//清空街道下拉列表
					$("#addressStreet").empty();
					$("<option value=\"0\">请选择</option>").appendTo($("#addressStreet"));
				}
			);

			//县市下拉列表改变的时候调用的方法，此时判断是否有街道信息，有点话则显示街道下拉列表框并显示内容
			$("#addressState").change(
				function(){
					
					//根据选择的省、地区、县市信息显示街道信息 
					$("#addressStreet").empty();
					intiRegionByregionCode(serverIp,"acid","addressStreet","/region/findCityOrState.do",$("#addressState option:selected").val());
				}
			);
		}
		
		 //participants.value = userName ;
	   	 //主界面和侧滑菜单界面均支持区域滚动；
	   			mui('#offCanvasSideScroll').scroll();
	   			mui('#offCanvasContentScroll').scroll();
	   			 //实现ios平台原生侧滑关闭页面；
	   			if (mui.os.plus && mui.os.ios) {
	   				mui.plusReady(function() { //5+ iOS暂时无法屏蔽popGesture时传递touch事件,直接屏蔽popGesture功能
	   					plus.webview.currentWebview().setStyle({
	   						'popGesture': 'none'
	   					});
	   				});
	   			}
	   			
	   			});
			//查询负责人	
			function gethtList() {
				var chargePerson = $('#chargePerson').val();
				$.ajax({
			url: 'http://'+serverIp+'/gtims/linkman/list.do?userId='+localStorage.getItem("id"),
			async: false,
			data:{'start':'0','end':'10000'},
			dataType: 'json',
			crossDomain: true,
			success: function(data) {
			 var html = "",obj=data.data;
				for (var i = 0; i < obj.length; i++) {
				    html+='<li class="mui-table-view-cell mui-indexed-list-item mui-radio mui-media mui-left">'+
					'<input type="radio"  name="radio"  value="'+obj[i].id+'" ryname="'+obj[i].name+'"  ';
					if(obj[i].id==chargePerson){
						html+=' checked="checked" ';
					}				
					html+='/><div class="mui-media-body mui-ellipsis">'+obj[i].name+'('+obj[i].address+')'+
										'<p class="mui-ellipsis">'+obj[i].phoneMobile+'</p>'+
									'</div></li>';
				}
			document.querySelector('#ryList').innerHTML = html;
		}
		});
			}
</script>
</body>
</html>